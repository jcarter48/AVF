var dbModule = require("database");
//getData 3 for recent matches
var getData3 = function(obj, x5) {

	var url = "https://na.api.pvp.net/api/lol/na/v1.3/game/by-summoner/" + x5 + "/recent?api_key=0ae1d37e-0440-419e-a952-c827eec43d86";

	var onLoad = function() {

		var riotInfo = JSON.parse(this.responseText);
		
		// for (var n in riotInfo) {
			// console.log(riotInfo[n][0].name);
		// };
		//console.log(riotInfo.games[0].playerOrTeamName);
		
		var riotArray = [];
	
		for (var i = 0,
		    j = riotInfo.games.length; i < j; i++) {
			riotArray.push({
				kills : riotInfo.games[i].championsKilled,
				deaths : riotInfo.games[i].numDeaths,
				assists : riotInfo.games[i].assists,
				cs : riotInfo.games[i].minionsKilled,
				playTime : riotInfo.games[i].timePlayed,
				win : riotInfo.games[i].win
			});
		}
		//console.log(kills, "...");
		obj.recent = riotArray;
	};

	var onError = function(x6) {
		console.log("error getting data", x6.error);
	};

	var xhr = Ti.Network.createHTTPClient({
		onload : onLoad,
		onerror : onError,
		timeout : 3000
	});

	xhr.open("GET", url);
	xhr.send();
};

//getData 2 for summoner id
var getData2 = function(x3) {
//console.log("x3", x3);
	var url = "https://na.api.pvp.net/api/lol/na/v2.5/league/by-summoner/" + x3 +"/entry?api_key=0ae1d37e-0440-419e-a952-c827eec43d86";

	var onLoad = function() {

		var riotInfo = JSON.parse(this.responseText);
	
		for (var n in riotInfo) {
	//console.log(riotInfo[n][0].entries[0].division, "...");
			var riotObj = {
			summoner : riotInfo[n][0].entries[0].playerOrTeamName,
			queue : riotInfo[n][0].queue,
			name : riotInfo[n][0].name,
			tier : riotInfo[n][0].tier,
			division : riotInfo[n][0].entries[0].division,
			leaguePoints : riotInfo[n][0].entries[0].leaguePoints,
			wins : riotInfo[n][0].entries[0].wins,
			losses : riotInfo[n][0].entries[0].losses,
			streak : riotInfo[n][0].entries[0].isHotStreak,
			veteran : riotInfo[n][0].entries[0].isVeteran,
			new : riotInfo[n][0].entries[0].isFreshBlood,
			inactive : riotInfo[n][0].entries[0].isInactive
		};
		};
		
		
		getData3(riotObj, x3);
		dbModule.save(riotObj);
		adbModule.saveCloud(riotObj);

	};

	var onError = function(x4) {
		console.log("error getting data", x4.error);
	};

	var xhr = Ti.Network.createHTTPClient({
		onload : onLoad,
		onerror : onError,
		timeout : 3000
	});

	xhr.open("GET", url);
	xhr.send();
};


//catch textfield value
var getData1 = function(x1) {
	console.log(x1, ".... x1");
	
	var url = "https://na.api.pvp.net/api/lol/na/v1.4/summoner/by-name/" + x1 + "/?api_key=0ae1d37e-0440-419e-a952-c827eec43d86";
	
	var onLoad = function() {

		var riotInfo = JSON.parse(this.responseText);
		for (var n in riotInfo) {
			//console.log(riotInfo[n].id);
			getData2(riotInfo[n].id);
			getData3(riotInfo[n].id);
		};
		//console.log(riotInfo);
		//console.log(riotInfo.id);
		
	};

	var onError = function(x2) {
		console.log("error getting data", x2.error);
	};

	var xhr = Ti.Network.createHTTPClient({
		onload : onLoad,
		onerror : onError,
		timeout : 3000
	});

	xhr.open("GET", url);
	xhr.send();
};
exports.getData1 = getData1;
