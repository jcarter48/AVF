var geoModule = require("geo");

//console.log(geoModule.getCoords + "....");

var dataPull = function() {
	var url = "http://api.wunderground.com/api/465b4ffeedaac08a/forecast/geolookup/q/" + geoModule.lat + "," + geoModule.lng + ".json";
	//var url = "http://api.wunderground.com/api/465b4ffeedaac08a/forecast/geolookup/q/" + 40.689244 + "," + geoModule.lng + ".json";
	
	console.log("long: "+ geoModule.lng);
	
	if (Ti.Network.online) {
		var getData = Ti.Network.createHTTPClient({
			onload : function(e) {
				console.log(e);
				var weatherInfo = JSON.parse(this.responseText);
				
				console.log(weatherInfo);

				var weatherObj = {
					city : weatherInfo.location.city,
					country : weatherInfo.location.country_name
				};

				var ui = require("ui");
				ui.buildUI(weatherObj);
				console.log(weatherObj);
			}
		});

		getData.open("GET", url);
		getData.send();

	} else {
		alert("Network currently unavailable.");
	}
};
exports.dataPull = dataPull;
